# 譜面ファイル(JSON)の書き方

## ノーツの動き方

全てのノーツはそれぞれ何らかの円周上を動いていると考えます。また、以下の画像のようにノーツは直線に並ぶことが多く、直線毎に分割することが可能です。

![ノーツの動き方](img/diva.jpg)

## 譜面ファイルの内部構造

譜面ファイルの中身は`Group`オブジェクトが入った`Groups`という配列で表現しています。数値は `Route` の `theta` を除いて全て整数です。( `theta` は少数)

### Group

`Group` は `Route` と `Note` の集まりです。 `Group` は上記の画像の各点線を１つの集合とみなしたものです。

### Route

ノーツの描く軌道や、点線の角度などの情報を保持するJSONオブジェクトです。

```json
"Route": {
	"center": {
        "x": -100, 
        "y": -100
    }, 
    "pos": {
        "x": 50, 
        "y": 250
    }, 
        "direction": 1, 
        "speed": 70, 
        "theta": 0.5,
        "time": 30,
        "figure": 0
}
```

- `center`
	- ノーツが動く軌道の円の中心座標オブジェクト
	- `x` と `y` の療法を指定する(直交座標系)
- `pos`
	- 最初のノーツの位置座標オブジェクト
	- `x` と `y` の療法を指定する(直交座標系)
- `speed`
	- ノーツの動く速さ(グループ内で一定)
- `theta`
	- ノーツが並ぶ直線の傾き(極座標系で0〜6.28)
- `direction`
	- ノーツの回転方向
	-  1 : 時計回り
	- -1 : 反時計回り
- `timing`
	- 最初のノーツが押される理想のタイミング
	- 曲が始まってからの時間を指定(1あたり0.05秒)
- `figure`
	- 最初のノーツの形(0:◯, 1:X, 2:△, 3:◻)
- `duration`
	- 最初のノーツの長押しのノーツのときのみ記載
	- 押してる時間を指定

### Notes

グループの先頭のノーツを除くノーツは `Notes` というJSON配列の中に格納します。１つ前のノーツとの差を指定してください。

```json
"Notes": [
	{
		"distance": 60, 
		"figure": 0, 
		"time": 5
	}, 
	{
		"distance": 60, 
		"figure": 0,
		"time": 5,
		"duration": 10
	},
	
	:
	
]
```

- `distance`
	- １つ前のノーツとの距離を指定する(極座標系)
	- 座標の変位は `(distance, theta)`
	- 中心方向が負
- `time`
	- 時間の変位を指定する
- `figure`
	- ノーツの形(0:◯, 1:X, 2:△, 3:◻)
- `duration`
	- ノーツの長押しのノーツのときのみ記載
	- 押してる時間を指定

## JSONサンプル

```json

{
    "Groups": [
        {
            "Route": {
                "center": {
                    "x": -100, 
                    "y": -100
                }, 
                "pos": {
                    "x": 50, 
                    "y": 250
                }, 
                "direction": 1, 
                "speed": 70, 
                "theta": 0.5,
                "time": 30,
                "figure": 0
            }, 
            "Notes": [
                {
                    "distance": 60, 
                    "figure": 0, 
                    "time": 5
                }, 
                {
                    "distance": 60, 
                    "figure": 0, 
                    "time": 5,
                    "duration": 10
                },
                
                :
                
            ]
        },
        
        :
        
    ]
}
```